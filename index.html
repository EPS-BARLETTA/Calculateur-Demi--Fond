<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Calculateur Demi‚Äëfond ‚Äì VMA, % et Tours</title>
  <style>
    :root{
      --bg:#f6f8fb; --card:#ffffff; --ink:#0f172a; --muted:#64748b;
      --primary:#2563eb; --accent:#10b981; --warn:#f59e0b; --danger:#ef4444;
      --radius:14px; --shadow:0 10px 30px rgba(2,6,23,.08);
    }
    *{box-sizing:border-box;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif}
    body{margin:0;background:var(--bg);color:var(--ink)}
    .wrap{max-width:1100px;margin:32px auto;padding:0 16px}
    header{display:flex;gap:16px;align-items:center;justify-content:space-between;margin-bottom:18px}
    h1{font-size:clamp(20px,3vw,28px);margin:0}
    .subtitle{color:var(--muted);font-size:14px}
    .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:16px}
    .card{grid-column:span 12;background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);padding:18px}
    @media(min-width:900px){.card.half{grid-column:span 6}}
    .card h2{font-size:18px;margin:0 0 8px}
    .row{display:grid;grid-template-columns:160px 1fr 110px;gap:10px;align-items:center;margin:10px 0}
    .row label{color:var(--muted);font-size:14px}
    input[type="number"], input[type="text"], select{width:100%;padding:10px 12px;border:1px solid #e5e7eb;border-radius:10px;background:#fff}
    .help{font-size:12px;color:var(--muted)}
    .btns{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
    button{border:0;border-radius:12px;padding:10px 14px;font-weight:600;cursor:pointer}
    .primary{background:var(--primary);color:#fff}
    .ghost{background:#eef2ff;color:#1e3a8a}
    .accent{background:var(--accent);color:#052e1a}
    .warn{background:#fff7ed;color:#9a3412}
    .danger{background:#fee2e2;color:#7f1d1d}
    .out{margin-top:12px;padding:12px;border-radius:12px;background:#f8fafc;border:1px solid #e2e8f0}
    .out b{display:inline-block;min-width:180px}
    .recap{margin-top:12px;padding:12px;border-radius:12px;background:#eef2ff;border:1px solid #c7d2fe}
    .kpi{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-top:10px}
    .kpi div{background:#f1f5f9;border:1px solid #e2e8f0;border-radius:12px;padding:10px;text-align:center}
    .kpi h3{margin:4px 0 0;font-size:18px}
    .kpi span{display:block;color:var(--muted);font-size:12px}
    table{width:100%;border-collapse:collapse}
    th,td{border:1px solid #e2e8f0;padding:8px;text-align:center}
    th{background:#f1f5f9}
    footer{margin:20px 0;color:var(--muted);font-size:12px;text-align:center}
    /* Page d'accueil centr√©e */
    #home{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:100vh;text-align:center}
    #home h1{font-size:clamp(28px,6vw,42px);margin-bottom:12px}
    #home button{font-size:20px;padding:16px 28px;background:var(--primary);color:#fff;border-radius:16px}
  </style>
</head>
<body>

  <!-- Page d'accueil -->
  <div id="home">
    <h1>Calculateur Demi‚Äëfond</h1>
    <p class="subtitle">Application EPS ‚Äì VMA, % et Tours</p>
    <button onclick="startApp()">üöÄ D√©marrer</button>
  </div>

  <!-- Application -->
  <div id="app" class="wrap" style="display:none">
    <header>
      <div>
        <h1>Calculateur Demi‚Äëfond</h1>
        <div class="subtitle">Piste personnalis√©e (ex. 253 m) ‚Ä¢ Allure √† %VMA ‚Ä¢ Tours, temps au tour, distances</div>
      </div>
    </header>

    <div class="grid">

      <!-- Bloc A : √Ä partir de VMA & % -->
      <section class="card half">
        <h2>A. √Ä partir de la VMA et du %</h2>
        <div class="row">
          <label for="lap">Distance d‚Äôun tour (m)</label>
          <input id="lap" type="number" min="50" step="1" value="253" />
          <div class="help">ex. 253</div>
        </div>
        <div class="row">
          <label for="vma">VMA (km/h)</label>
          <input id="vma" type="number" min="6" max="25" step="0.1" value="12" />
          <div class="help">VMA mesur√©e (Luc L√©ger, VAMEVAL‚Ä¶)</div>
        </div>
        <div class="row">
          <label for="pct">Intensit√© (% VMA)</label>
          <input id="pct" type="number" min="50" max="110" step="1" value="80" />
          <div class="help">G√©n√©ralement 70‚Äì90 %</div>
        </div>
        <div class="row">
          <label for="dur">Dur√©e de l‚Äôeffort (min)</label>
          <input id="dur" type="number" min="1" step="1" value="15" />
          <div class="btns">
            <button class="ghost" onclick="setDur(12)">12 min</button>
            <button class="ghost" onclick="setDur(15)">15 min</button>
            <button class="ghost" onclick="setDur(20)">20 min</button>
          </div>
        </div>
        <div class="btns">
          <button class="primary" onclick="calcFromVMA()">Calculer</button>
          <button class="danger" onclick="resetA()">R√©initialiser</button>
        </div>
        <div id="outA" class="out" hidden></div>
        <!-- R√©cap A juste dessous -->
        <div id="recapA" class="recap" hidden>
          <h3>R√©capitulatif</h3>
          <div class="kpi">
            <div><span>Allure (m/min)</span><h3 id="k1">‚Äî</h3></div>
            <div><span>Allure (km/h)</span><h3 id="k2">‚Äî</h3></div>
            <div><span>Temps au tour</span><h3 id="k3">‚Äî</h3></div>
            <div><span>Tours sur la dur√©e</span><h3 id="k4">‚Äî</h3></div>
          </div>
        </div>
      </section>

      <!-- Bloc B : √Ä partir d‚Äôun temps ou d‚Äôune dur√©e globale -->
      <section class="card half">
        <h2>B. √Ä partir d‚Äôun temps ou d‚Äôune dur√©e ‚Üí tours & %VMA</h2>
        <div class="row">
          <label for="lap2">Distance d‚Äôun tour (m)</label>
          <input id="lap2" type="number" min="50" step="1" value="253" />
          <div class="help">ex. 253</div>
        </div>
        <div class="row">
          <label for="vma2">VMA (km/h)</label>
          <input id="vma2" type="number" min="6" max="25" step="0.1" value="12" />
          <div class="help">Pour estimer le %VMA</div>
        </div>
        <div class="row">
          <label for="lapTime">Temps au tour (mm:ss)</label>
          <input id="lapTime" type="text" placeholder="01:40" />
          <div class="help">Option 1 : indique un temps au tour</div>
        </div>
        <div class="row">
          <label for="dur2">Dur√©e totale (min)</label>
          <input id="dur2" type="number" min="1" step="1" value="15" />
          <div class="help">Option 2 : indique une dur√©e pour obtenir le nombre de tours</div>
        </div>
        <div class="btns">
          <button class="primary" onclick="calcFromTime()">Calculer</button>
          <button class="danger" onclick="resetB()">R√©initialiser</button>
        </div>
        <div id="outB" class="out" hidden></div>
        <!-- R√©cap B juste dessous -->
        <div id="recapB" class="recap" hidden>
          <h3>R√©capitulatif</h3>
          <div id="recapBContent">‚Äî</div>
        </div>
      </section>

      <!-- Bloc S : Mode S√©ance (presets) -->
      <section class="card">
        <h2>üéØ Mode S√©ance (presets)</h2>
        <div class="row" style="grid-template-columns:220px 1fr 260px">
          <label for="preset">Choisir une s√©ance type</label>
          <select id="preset">
            <option value="">‚Äî S√©lectionne ‚Äî</option>
            <option value="2x6-80-3">2 √ó 6' @80% (r√©cup 3')</option>
            <option value="3x6-85-3">3 √ó 6' @85% (r√©cup 3')</option>
            <option value="4x4-90-2">4 √ó 4' @90% (r√©cup 2')</option>
            <option value="12x1-80-0">12' continu @80%</option>
            <option value="15x1-80-0">15' projet @80%</option>
            <option value="20x1-80-0">20' projet @80%</option>
          </select>
          <div class="btns">
            <button class="primary" onclick="buildSession()">G√©n√©rer cibles</button>
            <button class="ghost" onclick="applyToInputs()">üîÅ Appliquer aux champs</button>
            <button class="accent" onclick="showSummary('preset')">R√©sum√© s√©ance</button>
          </div>
        </div>
        <div id="outS" class="out" hidden></div>
      </section>

      <!-- Bloc SP : S√©ance personnalis√©e -->
      <section class="card">
        <h2>üõ†Ô∏è S√©ance personnalis√©e</h2>
        <div class="row" style="grid-template-columns:200px repeat(3,1fr)">
          <label for="repCount">R√©p√©titions √ó dur√©e (min)</label>
          <input id="repCount" type="number" min="1" step="1" value="3" />
          <input id="repMin" type="number" min="1" step="1" value="6" />
          <div class="help">ex. 3 √ó 6'</div>
        </div>
        <div class="row">
          <label for="pctP">Intensit√© (% VMA)</label>
          <input id="pctP" type="number" min="50" max="110" step="1" value="80" />
          <div class="help">g√©n√©ralement 70‚Äì90 %</div>
        </div>
        <div class="row">
          <label for="recP">R√©cup√©ration (min)</label>
          <input id="recP" type="number" min="0" step="0.5" value="3" />
          <div class="help">entre les r√©p√©titions</div>
        </div>
        <div class="btns">
          <button class="primary" onclick="buildCustom()">Calculer la s√©ance</button>
          <button class="accent" onclick="showSummary('custom')">R√©sum√© s√©ance</button>
        </div>
        <div id="outSP" class="out" hidden></div>
      </section>

      <!-- Bloc (dev) Tests ‚Äì repli√© par d√©faut pour ne pas g√™ner -->
      <section class="card">
        <details>
          <summary>üß™ Tests automatis√©s (dev)</summary>
          <ul id="testResults"></ul>
        </details>
      </section>

    </div>

    <footer>
      ¬© 2025 ‚Ä¢ Calculateur Demi‚Äëfond ‚Äì √âquipe EPS Lyc√©e Vauban Luxembourg ‚Äì JB
    </footer>
  </div>

  <!-- Modal R√©sum√© (hors‚Äëligne) -->
  <div id="qrModal" style="position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;padding:20px">
    <div style="background:#fff;border-radius:16px;max-width:720px;width:min(90vw,720px);max-height:90vh;padding:20px;box-shadow:var(--shadow);text-align:left;display:flex;flex-direction:column;gap:8px">
      <h3 style="margin:0 0 8px">R√©sum√© de la s√©ance (hors‚Äëligne)</h3>
      <textarea id="qrText" style="width:100%;height:260px;border:1px solid #e2e8f0;border-radius:12px;padding:12px;font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace"></textarea>
      <div class="btns" style="justify-content:flex-end;margin-top:8px">
        <button class="ghost" onclick="copySummary()">Copier</button>
        <button class="primary" onclick="closeQR()">Fermer</button>
      </div>
      <div class="help" style="margin-top:6px">Astuce : affiche ce texte aux √©l√®ves (photo) ‚Äì fonctionne sans Wi‚ÄëFi.</div>
    </div>
  </div>

<script>
  // === App entry ===
  function startApp(){
    document.getElementById('home').style.display = 'none';
    document.getElementById('app').style.display = 'block';
  }

  // === Utils ===
  const toSeconds = (mmss) => {
    if(!mmss) return NaN;
    const parts = mmss.split(":").map(Number);
    if(parts.length === 1) return parts[0];
    if(parts.length === 2) return parts[0]*60 + parts[1];
    return NaN;
  };
  const toMMSS = (sec) => {
    if(!isFinite(sec) || sec<=0) return "‚Äî";
    const m = Math.floor(sec/60);
    const s = Math.round(sec%60);
    return `${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
  };
  const round = (x, d=2) => Number.isFinite(x) ? Number(x.toFixed(d)) : NaN;
  function setDur(val){ document.getElementById('dur').value = val; }

  // === A: From VMA & % ===
  function calcFromVMA(){
    const lap = parseFloat(document.getElementById('lap').value);
    const vma = parseFloat(document.getElementById('vma').value);
    const pct = parseFloat(document.getElementById('pct').value);
    const dur = parseFloat(document.getElementById('dur').value);
    if(!lap || !vma || !pct || !dur){ alert('Compl√®te tous les champs.'); return; }

    const v_kmh = vma * (pct/100);
    const v_mps = v_kmh * 1000 / 3600;
    const v_mpm = v_kmh * 1000 / 60;

    const lapTime_s = lap / v_mps;
    const totalDist = v_mpm * dur;
    const laps = totalDist / lap;

    const out = document.getElementById('outA');
    out.hidden = false;
    out.innerHTML = `
      <div><b>Vitesse √† ${pct}%VMA :</b> ${round(v_kmh,2)} km/h ‚Ä¢ ${round(v_mpm,1)} m/min</div>
      <div><b>Temps au tour (${lap} m) :</b> ${toMMSS(lapTime_s)} (‚âà ${round(lapTime_s,1)} s)</div>
      <div><b>En ${dur} min :</b> ${Math.round(totalDist)} m ‚Ä¢ ‚âà ${round(laps,2)} tours</div>
    `;

    document.getElementById('k1').textContent = `${round(v_mpm,1)} m/min`;
    document.getElementById('k2').textContent = `${round(v_kmh,2)} km/h`;
    document.getElementById('k3').textContent = toMMSS(lapTime_s);
    document.getElementById('k4').textContent = `${round(laps,2)} tours`;
    document.getElementById('recapA').hidden = false;
  }
  function resetA(){
    document.getElementById('lap').value = 253;
    document.getElementById('vma').value = 12;
    document.getElementById('pct').value = 80;
    document.getElementById('dur').value = 15;
    document.getElementById('outA').hidden = true;
    document.getElementById('recapA').hidden = true;
  }

  // === B: From time or duration ===
  function calcFromTime(){
    const lap = parseFloat(document.getElementById('lap2').value);
    const vma = parseFloat(document.getElementById('vma2').value);
    const lapTimeTxt = document.getElementById('lapTime').value.trim();
    const dur = parseFloat(document.getElementById('dur2').value);
    if(!lap || !vma){ alert('Renseigne distance de tour et VMA.'); return; }

    let html = '';
    if(lapTimeTxt){
      const lapTime_s = toSeconds(lapTimeTxt);
      if(!isFinite(lapTime_s)){ alert('Temps au tour invalide. Format mm:ss'); return; }
      const v_mps = lap / lapTime_s;
      const v_kmh = v_mps * 3.6;
      const pct = (v_kmh / vma) * 100;
      html += `<div><b>Allure mesur√©e :</b> ${round(v_kmh,2)} km/h ‚Ä¢ ${round(v_mps*60,1)} m/min ‚Ä¢ ‚âà ${round(pct,1)}% VMA</div>`;
    }
    if(dur){
      const pctList = [70,80,90];
      html += `<div style="margin-top:6px"><b>Tours √† r√©aliser en ${dur} min :</b></div>`;
      html += '<ul style="margin:6px 0 0 18px">';
      pctList.forEach(p=>{
        const v_kmh = vma * (p/100);
        const v_mpm = v_kmh * 1000 / 60;
        const dist = v_mpm * dur;
        const laps = dist / lap;
        html += `<li>${p}% VMA ‚Üí ${Math.round(dist)} m ‚Ä¢ ‚âà ${round(laps,2)} tours</li>`;
      });
      html += '</ul>';
    }
    if(!html){ html = '<div>Aucun calcul : indique au moins un temps au tour ou une dur√©e.</div>'; }

    const out = document.getElementById('outB');
    out.hidden = false;
    out.innerHTML = html;
    document.getElementById('recapBContent').innerHTML = html;
    document.getElementById('recapB').hidden = false;
  }
  function resetB(){
    document.getElementById('lap2').value = 253;
    document.getElementById('vma2').value = 12;
    document.getElementById('lapTime').value = '';
    document.getElementById('dur2').value = 15;
    document.getElementById('outB').hidden = true;
    document.getElementById('recapB').hidden = true;
  }

  // === S: Presets ===
  function parsePreset(code){
    if(!code) return null;
    const [left, right] = code.split('-');
    const reps = Number(left.split('x')[0]);
    const repMin = Number(left.split('x')[1]);
    const pct = Number(right.split('-')[0] || right);
    const rec = Number(right.split('-')[1] || 0);
    return {reps, repMin, pct, rec};
  }
  function buildSession(){
    const sel = document.getElementById('preset').value;
    if(!sel){ alert('Choisis une s√©ance.'); return; }
    const preset = parsePreset(sel);
    const lap = parseFloat(document.getElementById('lap').value) || 253;
    const vma = parseFloat(document.getElementById('vma').value) || 12;
    const v_kmh = vma * (preset.pct/100);
    const v_mps = v_kmh * 1000 / 3600;
    const v_mpm = v_kmh * 1000 / 60;

    let rows = '';
    let totalDist = 0;
    for(let i=1;i<=preset.reps;i++){
      const dist = v_mpm * preset.repMin;
      const laps = dist / lap;
      const lapTime_s = lap / v_mps;
      totalDist += dist;
      rows += `<tr><td>${i}</td><td>${preset.repMin}'</td><td>${preset.pct}%</td><td>${Math.round(dist)} m</td><td>${round(laps,2)}</td><td>${toMMSS(lapTime_s)}</td></tr>`;
    }
    const totalLaps = totalDist / lap;
    const lapTime_s = lap / v_mps;

    const html = `
      <div><b>Entr√©es :</b> Tour ${lap} m ‚Ä¢ VMA ${vma} km/h ‚Ä¢ ${preset.reps} √ó ${preset.repMin}' @ ${preset.pct}% (r√©cup ${preset.rec||0}')
      <br><b>Temps au tour conseill√© :</b> ${toMMSS(lapTime_s)} (‚âà ${round(lapTime_s,1)} s)</div>
      <div style="margin-top:8px;overflow:auto">
        <table>
          <thead><tr><th>R√©p√©tition</th><th>Dur√©e</th><th>%VMA</th><th>Distance</th><th>Tours</th><th>Temps/tour</th></tr></thead>
          <tbody>${rows}</tbody>
          <tfoot><tr><th colspan="3">Total</th><th>${Math.round(totalDist)} m</th><th>${round(totalLaps,2)}</th><th>‚Äî</th></tr></tfoot>
        </table>
      </div>`;

    const out = document.getElementById('outS');
    out.hidden = false;
    out.innerHTML = html;
  }
  function applyToInputs(){
    const sel = document.getElementById('preset').value;
    if(!sel){ alert('Choisis une s√©ance.'); return; }
    const preset = parsePreset(sel);
    document.getElementById('pct').value = preset.pct;
    document.getElementById('dur').value = preset.repMin;
    calcFromVMA();
  }

  // === SP: Custom session ===
  function buildCustom(){
    const lap = parseFloat(document.getElementById('lap').value) || 253;
    const vma = parseFloat(document.getElementById('vma').value) || 12;
    const reps = parseFloat(document.getElementById('repCount').value);
    const repMin = parseFloat(document.getElementById('repMin').value);
    const pct = parseFloat(document.getElementById('pctP').value);
    const rec = parseFloat(document.getElementById('recP').value) || 0;
    if(!lap || !vma || !reps || !repMin || !pct){ alert('Compl√®te les champs de la s√©ance perso.'); return; }

    const v_kmh = vma * (pct/100);
    const v_mps = v_kmh * 1000 / 3600;
    const v_mpm = v_kmh * 1000 / 60;

    let rows = '';
    let totalDist = 0;
    for(let i=1;i<=reps;i++){
      const dist = v_mpm * repMin;
      const laps = dist / lap;
      const lapTime_s = lap / v_mps;
      totalDist += dist;
      rows += `<tr><td>${i}</td><td>${repMin}'</td><td>${pct}%</td><td>${Math.round(dist)} m</td><td>${round(laps,2)}</td><td>${toMMSS(lapTime_s)}</td></tr>`;
    }
    const totalLaps = totalDist / lap;
    const totalTimeMin = reps*repMin + rec*(reps-1);
    const lapTime_s = lap / v_mps;

    const html = `
      <div><b>Entr√©es :</b> Tour ${lap} m ‚Ä¢ VMA ${vma} km/h ‚Ä¢ ${reps} √ó ${repMin}' @ ${pct}% (r√©cup ${rec}')
      <br><b>Temps au tour conseill√© :</b> ${toMMSS(lapTime_s)} (‚âà ${round(lapTime_s,1)} s) ‚Ä¢ <b>Dur√©e totale estim√©e :</b> ${totalTimeMin}'</div>
      <div style="margin-top:8px;overflow:auto">
        <table>
          <thead><tr><th>R√©p√©tition</th><th>Dur√©e</th><th>%VMA</th><th>Distance</th><th>Tours</th><th>Temps/tour</th></tr></thead>
          <tbody>${rows}</tbody>
          <tfoot><tr><th colspan="3">Total</th><th>${Math.round(totalDist)} m</th><th>${round(totalLaps,2)}</th><th>‚Äî</th></tr></tfoot>
        </table>
      </div>`;

    const out = document.getElementById('outSP');
    out.hidden = false;
    out.innerHTML = html;
  }

  // === Session summary for sharing ===
  function sessionSummary(kind){
    const lap = parseFloat(document.getElementById('lap').value) || 253;
    const vma = parseFloat(document.getElementById('vma').value) || 12;
    let txt = '';
    if(kind==='preset'){
      const sel = document.getElementById('preset').value;
      if(!sel) return '';
      const p = parsePreset(sel);
      const v_kmh = vma * (p.pct/100);
      const v_mps = v_kmh * 1000/3600;
      const lapTime_s = lap / v_mps;
      txt = `S√©ance: ${p.reps}x${p.repMin}' @${p.pct}% (r:${p.rec||0}')\nTour:${lap} m | VMA:${vma} km/h\nTemps au tour conseill√©: ${toMMSS(lapTime_s)}\nObjectif par r√©p.: ${Math.round((v_kmh*1000/60)*p.repMin)} m (~${((v_kmh*1000/60)*p.repMin/lap).toFixed(2)} tours)`;
    } else {
      const reps = parseFloat(document.getElementById('repCount').value);
      const repMin = parseFloat(document.getElementById('repMin').value);
      const pct = parseFloat(document.getElementById('pctP').value);
      const rec = parseFloat(document.getElementById('recP').value)||0;
      if(!reps||!repMin||!pct) return '';
      const v_kmh = vma * (pct/100);
      const v_mps = v_kmh * 1000/3600;
      const lapTime_s = lap / v_mps;
      txt = `S√©ance: ${reps}x${repMin}' @${pct}% (r:${rec}')\nTour:${lap} m | VMA:${vma} km/h\nTemps au tour conseill√©: ${toMMSS(lapTime_s)}\nObjectif par r√©p.: ${Math.round((v_kmh*1000/60)*repMin)} m (~${((v_kmh*1000/60)*repMin/lap).toFixed(2)} tours)`;
    }
    return txt;
  }
  function showSummary(kind){
    const txt = sessionSummary(kind);
    if(!txt){ alert('Renseigne la s√©ance d\'abord.'); return; }
    document.getElementById('qrText').value = txt;
    document.getElementById('qrModal').style.display='flex';
  }
  function copySummary(){
    const ta = document.getElementById('qrText');
    ta.select();
    document.execCommand('copy');
  }
  function closeQR(){ document.getElementById('qrModal').style.display='none'; }

  // === Tests (dev) ‚Äì non intrusifs ===
  function runTests(){
    const ul = document.getElementById('testResults');
    if(!ul) return;
    const add = (ok,msg)=>{
      const li = document.createElement('li'); li.style.listStyle='none';
      li.style.margin='4px 0'; li.textContent=(ok?'‚úÖ ':'‚ùå ')+msg; ul.appendChild(li);
    };
    const approx=(a,b,eps=1e-2)=>Math.abs(a-b)<=eps;

    const p = parsePreset('3x6-85-3');
    add(p.reps===3 && p.repMin===6 && p.pct===85 && p.rec===3, 'parsePreset(3x6-85-3) OK');

    const lap=253, vma=12, pct=80; const v_kmh=vma*(pct/100), v_mps=v_kmh*1000/3600;
    const expectedLapS = lap / v_mps; add(approx(expectedLapS, 94.875, 0.5), 'Temps tour ~94.9s @12km/h 80% sur 253m');

    try{
      document.getElementById('lap').value = lap;
      document.getElementById('vma').value = vma;
      document.getElementById('repCount').value = 3;
      document.getElementById('repMin').value = 6;
      document.getElementById('pctP').value = 80;
      document.getElementById('recP').value = 3;
      buildCustom();
      add(document.getElementById('outSP').innerHTML.includes('<table'), 'buildCustom() g√©n√®re un tableau');
    }catch(e){ add(false, 'buildCustom() erreur: '+e.message); }

    const p2 = parsePreset('12x1-80-0');
    add(p2.reps===12 && p2.repMin===1 && p2.pct===80 && p2.rec===0, 'parsePreset(12x1-80-0) OK');
  }
  window.addEventListener('DOMContentLoaded', runTests);
</script>
</body>
</html>
